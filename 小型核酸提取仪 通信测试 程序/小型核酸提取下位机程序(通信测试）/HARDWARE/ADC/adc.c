#include "adc.h"
#include "delay.h"		 
#include "math.h"
#include <stdio.h> 
//////////////////////////////////////////////////////////////////////////////////	 


float ad[8];


//u16 TableAdc[8][72]={
//{3593,3516,3449,3359,3288,3206,3154,3070,3000,2934,2861,2789,2729,2665,2605,2550,2489,2431,2372,2321,2268,2218,2157,2121,2056,2012,1965,1918,1866,1823,1780,1737,1699,1648,1611,1575,1535,1496,1466,1427,1379,1351,1318,1285,1249,1221,1197,1163,1136,1101,
//	1087,1048,1027,994,964,940,912,891,864,846,830,810,789,774,751,735,710,697,679,661,647,630},
//{3609,3547,3487,3395,3324,3237,3188,3103,3027,2984,2905,2835,2769,2705,2645,2587,2525,2467,2408,2353,2301,2251,2190,2153,2092,2048,2000,1949,1901,1857,1813,1771,1727,1677,1639,1601,1562,1527,1496,1455,1406,1377,1344,1311,1280,1248,1224,1187,1160,1127,
//	1111,1072,1051,1023,993,968,945,921,895,874,854,836,813,798,775,754,734,718,700,683,668,651}, //1,2,3???
//{3557,3473,3402,3312,3235,3149,3096,3015,2940,2869,2798,2728,2650,2584,2525,2466,2409,2351,2276,2226,2176,2126,2062,2021,1962,1922,1863,1820,1772,1727,1685,1637,1594,1551,1515,1471,1436,1390,1363,1325,1283,1244,1218,1185,1149,1119,1098,1059,1035,992,
//	980,948,929,899,872,846,823,797,774,757,737,718,700,690,668,648,630,615,598,578,566,550},
//{3564,3480,3412,3320,3251,3168,3116,3034,2962,2890,2815,2745,2686,2622,2564,2505,2447,2392,2320,2268,2217,2169,2101,2067,2006,1962,1912,1864,1813,1770,1725,1687,1640,1598,1559,1521,1482,1440,1411,1372,1333,1302,1268,1237,1200,1165,1142,1107,1080,1047,
//	1033,994,975,946,917,892,869,848,820,803,788,764,742,728,707,690,670,657,638,622,608,590},


//{3615,3551,3448,3385,3294,3220,3152,3065,3019,2949,2874,2805,2733,2667,2603,2547,2490,2434,2379,2319,2266,2216,2161,2114,2054,2010,1958,1906,1866,1822,1768,1723,1684,1646,1604,1567,1536,1491,1449,1419,1374,1337,1304,1278,1245,1209,1183,1148,1122,1093,
//	1066,1038,1014,978,953,934,906,884,855,834,815,803,778,757,741,722,706,687,670,654,634,622},
//{3589,3542,3446,3369,3279,3213,3144,3062,3013,2941,2872,2804,2735,2669,2610,2554,2489,2432,2375,2320,2268,2217,2162,2115,2054,2009,1957,1906,1869,1817,1768,1727,1687,1651,1605,1565,1537,1491,1449,1417,1379,1341,1308,1281,1249,1212,1184,1154,1129,1098,
//	1070,1045,1017,987,960,940,915,893,864,841,823,808,781,765,750,724,709,690,673,658,640,631}, 
//	//1,2,3???
//{3521,3470,3373,3301,3215,3139,3082,2997,2933,2860,2789,2719,2649,2585,2524,2469,2401,2349,2295,2233,2183,2133,2066,2021,1964,1921,1870,1814,1779,1729,1674,1634,1592,1559,1514,1475,1442,1400,1360,1333,1289,1252,1216,1191,1159,1121,1095,1066,1033,1009,
//	982,953,932,901,878,859,833,811,784,761,743,733,707,687,674,655,635,617,600,585,570,564},
//{3522,3481,3384,3313,3225,3151,3093,3012,2953,2877,2805,2736,2670,2603,2544,2488,2426,2372,2313,2254,2207,2155,2097,2049,1989,1945,1894,1841,1803,1756,1704,1663,1624,1586,1547,1505,1470,1428,1389,1362,1318,1280,1247,1220,1186,1149,1120,1091,1064,1039,
//	1013,979,955,925,904,883,857,834,808,789,771,754,730,716,701,675,660,641,624,609,591,585}

//};
//      // 1850,1827,1807,1784,1768,1747,1732,1713,1694,1676,1659,1642,1626,1611,1595,1580,1566,1549,1536,1521,1508,1494,1480,1467,1454,1441,1430,1418,1408,1399,1388,1376,1366

//u16 TableDac[8][72]={
//{1697,1680,1666,1645,1630,1611,1600,1582,1565,1551,1535,1520,1507,1493,1479,1466,1453,1441,1428,1416,1405,1394,1381,1371,1357,1347,1337,1326,1315,1305,1295,1286,1277,1266,1258,1249,1242,
//	1233,1226,1217,1208,1201,1193,1187,1179,1172,1166,1159,1153,1146,1141,1134,1129,1122,1116,1111,1104,1099,1094,1089,1085,1081,1076,1072,1068,1064,1059,1055,1051,1047,1043,1039},
//	
//{1668,1655,1643,1622,1607,1588,1578,1560,1543,1534,1518,1503,1489,1475,1461,1448,1435,1423,1410,1398,1387,1376,1364,1354,1341,1331,1321,1310,1300,1290,1280,1272,1262,1251,1243,1234,1227,
//	1219,1212,1203,1194,1187,1179,1173,1166,1159,1153,1146,1140,1133,1128,1121,1116,1110,1104,1099,1093,1088,1083,1078,1073,1069,1064,1060,1056,1051,1047,1043,1039,1035,1031,1027},
//{1754,1734,1719,1697,1680,1660,1648,1630,1612,1596,1580,1564,1547,1532,1518,1504,1491,1478,1461,1449,1437,1426,1412,1401,1388,1378,1365,1355,1344,1333,1323,1313,1302,1292,1284,1274,1267,
//	1257,1250,1241,1232,1223,1216,1210,1201,1194,1188,1180,1174,1165,1160,1154,1149,1143,1137,1132,1125,1120,1115,1110,1105,1101,1097,1093,1089,1084,1080,1076,1072,1068,1064,1060},
//	
//{1701,1682,1668,1647,1632,1613,1602,1584,1567,1551,1535,1520,1507,1493,1479,1466,1453,1441,1425,1413,1402,1391,1377,1367,1354,1344,1333,1322,1311,1301,1290,1282,1272,1262,1254,1245,1238,
//	1228,1221,1212,1205,1197,1189,1183,1175,1167,1161,1154,1148,1141,1136,1129,1124,1118,1112,1107,1101,1096,1091,1086,1082,1077,1072,1068,1064,1060,1056,1052,1048,1044,1040,1036},
//	
//{1680,1666,1644,1631,1611,1595,1580,1562,1552,1536,1520,1505,1490,1476,1462,1449,1436,1424,1412,1398,1387,1376,1364,1354,1341,1331,1320,1309,1300,1290,1278,1270,1262,1252,1244,1236,1228,
//	1219,1210,1203,1194,1186,1179,1172,1165,1158,1152,1145,1139,1132,1127,1121,1115,1108,1102,1097,1091,1086,1081,1076,1072,1068,1064,1059,1055,1051,1048,1044,1040,1036,1032,1029},
//{1659,1649,1628,1612,1592,1578,1563,1546,1535,1519,1504,1489,1475,1461,1448,1435,1420,1408,1396,1383,1372,1361,1349,1339,1326,1316,1305,1295,1286,1275,1264,1256,1248,1239,1230,1221,1214,
//	1205,1196,1189,1181,1173,1166,1159,1152,1145,1139,1132,1126,1119,1114,1108,1102,1096,1090,1085,1079,1074,1069,1064,1060,1055,1051,1047,1043,1038,1035,1031,1027,1023,1020,1017},
//{1704,1693,1671,1656,1636,1620,1606,1588,1573,1556,1540,1525,1510,1496,1482,1469,1453,1441,1429,1414,1403,1392,1377,1367,1354,1344,1333,1321,1312,1301,1288,1280,1272,1263,1254,1245,1236,
//	1228,1219,1212,1203,1195,1187,1180,1173,1165,1159,1152,1145,1139,1134,1127,1122,1116,1110,1105,1099,1094,1089,1084,1080,1076,1072,1067,1063,1059,1055,1051,1047,1043,1040,1038},
//{1665,1657,1635,1621,1601,1585,1572,1555,1541,1525,1509,1494,1480,1466,1453,1440,1426,1414,1402,1388,1377,1366,1353,1343,1330,1320,1309,1298,1289,1278,1267,1259,1251,1241,1233,1224,1216,
//	1207,1199,1192,1183,1175,1168,1161,1153,1146,1140,1133,1127,1121,1116,1109,1103,1097,1092,1087,1081,1076,1071,1067,1063,1058,1054,1050,1046,1041,1038,1034,1030,1026,1023,1021}	
//};		



u16 TableAdc[8][72]={
{3593,3516,3449,3359,3288,3206,3154,3070,3000,2934,2861,2789,2729,2665,2605,2550,2489,2431,2372,2321,2268,2218,2157,2121,2056,2012,1965,1918,1866,1823,1780,1737,1699,1648,1611,1575,1535,1496,1466,1427,1379,1351,1318,1285,1249,1221,1197,1163,1136,1101,
	1087,1048,1027,994,964,940,912,891,864,846,830,810,789,774,751,735,710,697,679,661,647,630},
{3609,3547,3487,3395,3324,3237,3188,3103,3027,2984,2905,2835,2769,2705,2645,2587,2525,2467,2408,2353,2301,2251,2190,2153,2092,2048,2000,1949,1901,1857,1813,1771,1727,1677,1639,1601,1562,1527,1496,1455,1406,1377,1344,1311,1280,1248,1224,1187,1160,1127,
	1111,1072,1051,1023,993,968,945,921,895,874,854,836,813,798,775,754,734,718,700,683,668,651}, //1,2,3???
{3557,3473,3402,3312,3235,3149,3096,3015,2940,2869,2798,2728,2650,2584,2525,2466,2409,2351,2276,2226,2176,2126,2062,2021,1962,1922,1863,1820,1772,1727,1685,1637,1594,1551,1515,1471,1436,1390,1363,1325,1283,1244,1218,1185,1149,1119,1098,1059,1035,992,
	980,948,929,899,872,846,823,797,774,757,737,718,700,690,668,648,630,615,598,578,566,550},
{3564,3480,3412,3320,3251,3168,3116,3034,2962,2890,2815,2745,2686,2622,2564,2505,2447,2392,2320,2268,2217,2169,2101,2067,2006,1962,1912,1864,1813,1770,1725,1687,1640,1598,1559,1521,1482,1440,1411,1372,1333,1302,1268,1237,1200,1165,1142,1107,1080,1047,
	1033,994,975,946,917,892,869,848,820,803,788,764,742,728,707,690,670,657,638,622,608,590},


{3516,3442,3346,3283,3218,3152,3084,3004,2928,2852,2795,2727,2662,2598,2538,2480,2420,2363,2305,2253,2206,2146,2086,2040,1996,1940,1894,1849,1808,1757,1714,1674,1630,1593,1549,1509,1470,1439,1406,1363,1331,1295,1269,1235,1202,1170,1142,1108,1089,1054,
	1026,999,977,950,922,900,878,856,833,816,791,771,750,730,712,692,676,660,646,629,611,597},
{3508,3434,3338,3276,3206,3141,3070,2993,2914,2840,2788,2719,2656,2592,2532,2472,2418,2353,2295,2246,2196,2138,2077,2029,1984,1933,1883,1844,1802,1753,1712,1666,1622,1584,1543,1500,1461,1432,1398,1355,1322,1286,1260,1226,1193,1165,1140,1106,1088,1051,
	1022,997,968,944,920,897,874,853,828,810,787,766,746,726,707,688,671,657,640,626,610,595}, 
	//1,2,3???
{3458,3383,3285,3223,3144,3075,3007,2930,2854,2784,2711,2647,2580,2518,2456,2401,2344,2265,2211,2157,2110,2041,1984,1940,1897,1839,1791,1748,1708,1660,1610,1571,1525,1490,1441,1399,1368,1339,1306,1266,1226,1192,1167,1127,1094,1064,1037,1007,985,950,922,
	901,875,856,828,807,783,764,741,723,702,686,662,646,627,611,590,578,565,550,536,524},
{3471,3388,3293,3234,3155,3094,3028,2951,2873,2800,2744,2674,2611,2546,2487,2429,2368,2308,2248,2200,2153,2094,2033,1988,1945,1889,1841,1787,1747,1708,1667,1628,1577,1542,1495,1464,1419,1391,1359,1317,1284,1248,1223,1180,1153,1125,1098,1065,1042,1010,981,
	955,928,906,882,856,835,814,794,773,750,732,708,693,675,657,638,622,609,597,578,565}

};
      // 1850,1827,1807,1784,1768,1747,1732,1713,1694,1676,1659,1642,1626,1611,1595,1580,1566,1549,1536,1521,1508,1494,1480,1467,1454,1441,1430,1418,1408,1399,1388,1376,1366

u16 TableDac[8][72]={
{1697,1680,1666,1645,1630,1611,1600,1582,1565,1551,1535,1520,1507,1493,1479,1466,1453,1441,1428,1416,1405,1394,1381,1371,1357,1347,1337,1326,1315,1305,1295,1286,1277,1266,1258,1249,1242,
	1233,1226,1217,1208,1201,1193,1187,1179,1172,1166,1159,1153,1146,1141,1134,1129,1122,1116,1111,1104,1099,1094,1089,1085,1081,1076,1072,1068,1064,1059,1055,1051,1047,1043,1039},
	
{1668,1655,1643,1622,1607,1588,1578,1560,1543,1534,1518,1503,1489,1475,1461,1448,1435,1423,1410,1398,1387,1376,1364,1354,1341,1331,1321,1310,1300,1290,1280,1272,1262,1251,1243,1234,1227,
	1219,1212,1203,1194,1187,1179,1173,1166,1159,1153,1146,1140,1133,1128,1121,1116,1110,1104,1099,1093,1088,1083,1078,1073,1069,1064,1060,1056,1051,1047,1043,1039,1035,1031,1027},
{1754,1734,1719,1697,1680,1660,1648,1630,1612,1596,1580,1564,1547,1532,1518,1504,1491,1478,1461,1449,1437,1426,1412,1401,1388,1378,1365,1355,1344,1333,1323,1313,1302,1292,1284,1274,1267,
	1257,1250,1241,1232,1223,1216,1210,1201,1194,1188,1180,1174,1165,1160,1154,1149,1143,1137,1132,1125,1120,1115,1110,1105,1101,1097,1093,1089,1084,1080,1076,1072,1068,1064,1060},
	
{1701,1682,1668,1647,1632,1613,1602,1584,1567,1551,1535,1520,1507,1493,1479,1466,1453,1441,1425,1413,1402,1391,1377,1367,1354,1344,1333,1322,1311,1301,1290,1282,1272,1262,1254,1245,1238,
	1228,1221,1212,1205,1197,1189,1183,1175,1167,1161,1154,1148,1141,1136,1129,1124,1118,1112,1107,1101,1096,1091,1086,1082,1077,1072,1068,1064,1060,1056,1052,1048,1044,1040,1036},
	
{1664,1648,1627,1614,1599,1585,1570,1553,1536,1520,1508,1493,1479,1465,1452,1439,1426,1413,1401,1390,1379,1366,1353,1343,1333,1321,1311,1301,1292,1281,1272,1263,1253,1245,1236,1227,1218,
	1211,1204,1195,1188,1180,1174,1167,1160,1152,1146,1139,1134,1127,1121,1115,1110,1104,1098,1093,1088,1083,1078,1074,1069,1064,1060,1055,1051,1047,1043,1039,1036,1032,1028,1025},
{1647,1631,1610,1597,1581,1567,1552,1535,1518,1502,1491,1476,1462,1448,1435,1422,1410,1396,1384,1373,1362,1349,1336,1326,1316,1305,1294,1285,1276,1266,1257,1247,1237,1229,1220,1211,1202,
	1195,1188,1179,1172,1164,1158,1151,1144,1137,1131,1124,1119,1112,1106,1100,1094,1089,1083,1078,1073,1068,1063,1059,1054,1049,1045,1040,1036,1032,1028,1024,1021,1018,1014,1011
},
{1696,1679,1657,1644,1625,1609,1595,1577,1560,1544,1529,1514,1499,1485,1471,1458,1445,1427,1415,1403,1392,1377,1364,1354,1344,1331,1320,1310,1301,1290,1279,1270,1260,1252,1241,1232,1224,
	1217,1210,1201,1192,1184,1178,1169,1162,1154,1148,1142,1136,1129,1123,1118,1112,1107,1101,1096,1091,1086,1081,1077,1072,1068,1063,1059,1055,1051,1047,1043,1040,1036,1033,1030},
{1660,1642,1621,1608,1591,1577,1563,1546,1529,1513,1501,1486,1472,1458,1445,1432,1419,1405,1393,1382,1371,1358,1345,1335,1325,1313,1302,1290,1281,1273,1264,1255,1244,1236,1226,1219,1209,
	1202,1195,1186,1179,1171,1165,1156,1150,1143,1137,1130,1125,1118,1112,1106,1100,1095,1089,1084,1079,1074,1070,1065,1060,1056,1051,1047,1043,1039,1035,1031,1028,1025,1021,1018}	
};





//u16 TableAdc[8][72]={
//{3398,3293,3239,3159,3066,2982,2919,2840,2768,2695,2644,2576,2507,2447,2385,2321,2263,2211,2141,2085,2028,1981,1917,1875,1822,1763,1721,1680,1631,1583,1548,1501,1457,1413,1382,1343,1306,1269,1239,1205,1163,1129,1107,1072,1038,1021,984,953,933,902,872,
//	856,834,808,784,765,742,723,704,683,671,648,629,610,594,581,555,538,527,517,504,489},
//	
//	
//{3448,3357,3291,3204,3113,3057,2973,2895,2821,2744,2694,2628,2561,2494,2429,2373,2314,2262,2205,2145,2095,2028,1969,1925,1873,1831,1777,1728,1680,1637,1598,1555,1517,1472,1438,1400,1367,1320,1284,1252,1215,1183,1152,1123,1095,1064,1034,1004,973,949,923,
//897,872,842,820,800,782,757,736,717,705,687,666,647,632,607,597,577,557,543,532,521}, //1,2,3???
//{3366,3284,3200,3113,3019,2951,2869,2791,2719,2642,2570,2505,2439,2362,2300,2245,2172,2116,2063,2000,1953,1886,1828,1785,1732,1692,1633,1582,1537,1493,1455,1408,1370,1333,1288,1252,1219,1174,1145,1103,1070,1041,1006,977,949,917,891,865,836,813,786,760,
//739,709,692,673,652,634,614,596,587,571,550,532,523,496,488,471,455,443,435,425},
//{3396,3322,3240,3152,3062,2999,2917,2840,2767,2694,2633,2569,2502,2424,2363,2308,2250,2199,2146,2079,2029,1969,1913,1872,1816,1775,1716,1669,1623,1579,1539,1502,1454,1415,1373,1341,1308,1267,1230,1194,1157,1129,1098,1068,1036,1005,977,949,917,895,868,
//842,823,793,770,755,732,707,688,669,655,641,621,599,588,562,553,535,519,507,497,487},


//{3341,3275,3179,3117,3054,2967,2887,2805,2730,2676,2610,2539,2472,2410,2350,2287,2232,2168,2119,2064,2008,1960,1909,1864,1804,1760,1709,1656,1618,1578,1534,1482,1448,1412,1383,1338,1307,1260,1228,1197,1172,1130,1105,1064,1036,1009,979,955,933,903,873,
//	846,825,800,778,762,742,720,703,678,658,641,628,606,594,572,563,540,522,510,498,488},
//{3330,3281,3188,3125,3060,2975,2894,2816,2741,2680,2613,2556,2491,2432,2371,2314,2258,2183,2135,2081,2025,1978,1921,1876,1820,1776,1728,1676,1635,1595,1554,1516,1480,1437,1398,1357,1325,1284,1254,1221,1193,1151,1125,1087,1058,1029,997,972,947,922,892,
//	869,850,824,798,782,761,741,719,693,674,654,640,623,609,586,577,554,542,530,515,503}, 
//	//1,2,3???
//{3203,3170,3066,2987,2915,2831,2751,2674,2603,2529,2460,2397,2334,2275,2214,2157,2102,2021,1982,1933,1876,1829,1771,1730,1667,1629,1577,1521,1479,1445,1405,1368,1335,1290,1252,1214,1181,1141,1112,1080,1052,1014,986,948,921,896,868,839,812,792,766,743,
//	723,699,678,660,640,619,604,579,558,548,533,515,505,486,477,458,447,433,421,415
//},

//{3255,3202,3129,3055,2988,2903,2822,2741,2670,2605,2537,2473,2408,2348,2288,2227,2173,2113,2059,2009,1954,1904,1850,1806,1752,1712,1660,1611,1569,1532,1490,1444,1411,1369,1339,1297,1262,1226,1189,1155,1128,1097,1070,1031,1001,979,942,913,893,867,836,
//	816,794,774,748,731,712,689,672,648,628,613,601,579,564,548,536,518,502,487,477,464}



//};
//      // 1850,1827,1807,1784,1768,1747,1732,1713,1694,1676,1659,1642,1626,1611,1595,1580,1566,1549,1536,1521,1508,1494,1480,1467,1454,1441,1430,1418,1408,1399,1388,1376,1366

//u16 TableDac[8][72]={
//{1841,1816,1803,1784,1762,1741,1726,1707,1689,1671,1659,1642,1626,1611,1596,1580,1566,1549,1536,1523,1509,1497,1482,1471,1459,1444,1434,1424,1412,1401,1392,1380,1370,1359,1351,1341,1331,
//1323,1315,1307,1297,1289,1282,1275,1267,1261,1253,1247,1241,1233,1227,1221,1215,1209,1203,1198,1193,1188,1183,1178,1173,1168,1164,1159,1155,1151,1147,1143,1140,1137,1133,1130},
//	
//{1824,1802,1787,1766,1744,1731,1711,1692,1674,1656,1644,1628,1612,1596,1581,1567,1553,1540,1527,1512,1500,1484,1470,1459,1446,1436,1423,1411,1400,1389,1380,1369,1360,1349,1341,1331,1323,
//1312,1303,1295,1286,1279,1271,1264,1257,1249,1242,1235,1227,1221,1215,1209,1202,1196,1190,1185,1180,1174,1169,1164,1160,1155,1150,1146,1142,1138,1134,1129,1125,1121,1117,1114},
//{1828,1808,1788,1767,1745,1728,1708,1689,1671,1653,1636,1620,1604,1585,1570,1556,1538,1525,1512,1497,1485,1469,1455,1444,1431,1421,1407,1395,1384,1373,1364,1352,1343,1333,1323,1313,1305,
//1294,1287,1277,1269,1262,1253,1246,1239,1231,1225,1219,1211,1205,1199,1193,1187,1181,1176,1171,1166,1161,1156,1151,1148,1144,1139,1135,1132,1128,1124,1120,1117,1113,1110,1106},
//{1840,1822,1802,1781,1759,1744,1724,1705,1687,1669,1655,1639,1623,1604,1589,1575,1561,1548,1535,1519,1507,1492,1479,1468,1454,1444,1430,1418,1407,1396,1387,1377,1366,1356,1346,1337,1329,
//1319,1310,1301,1292,1285,1277,1270,1262,1254,1248,1241,1233,1227,1221,1215,1209,1203,1197,1192,1187,1181,1176,1171,1166,1162,1157,1152,1149,1145,1141,1137,1134,1130,1126,1122},
//	
//{1861,1844,1822,1807,1791,1770,1750,1730,1711,1698,1681,1664,1648,1632,1617,1602,1588,1572,1560,1547,1533,1521,1508,1497,1482,1471,1458,1445,1435,1425,1414,1402,1393,1384,1376,1365,1357,
//1346,1338,1330,1323,1313,1306,1296,1289,1282,1275,1269,1263,1256,1249,1241,1235,1229,1224,1219,1214,1209,1204,1199,1194,1190,1186,1181,1177,1172,1168,1164,1161,1157,1153,1151},
//{1843,1831,1809,1794,1778,1757,1737,1718,1699,1684,1667,1654,1638,1623,1608,1594,1580,1562,1550,1537,1523,1511,1497,1486,1472,1461,1449,1436,1426,1416,1406,1397,1388,1377,1367,1357,1349,
//1340,1332,1323,1316,1306,1299,1290,1283,1276,1268,1262,1255,1249,1242,1236,1230,1224,1218,1213,1208,1203,1197,1192,1187,1182,1178,1174,1170,1165,1161,1157,1155,1151,1147,1144
//},
//{1822,1813,1789,1770,1752,1731,1711,1692,1674,1656,1639,1624,1608,1593,1578,1564,1550,1531,1521,1509,1494,1482,1468,1457,1442,1432,1419,1405,1395,1386,1376,1367,1358,1347,1337,1328,1320,
//1310,1303,1294,1287,1278,1271,1262,1255,1249,1241,1234,1227,1222,1216,1210,1204,1198,1193,1188,1183,1178,1173,1168,1163,1160,1156,1152,1149,1145,1141,1138,1136,1132,1128,1126},
//{1807,1794,1778,1760,1744,1723,1703,1684,1666,1651,1634,1619,1603,1588,1573,1559,1545,1531,1518,1506,1492,1480,1467,1456,1443,1433,1420,1408,1398,1389,1379,1368,1359,1349,1341,1331,1323,
//1314,1305,1296,1289,1282,1275,1266,1259,1253,1244,1237,1231,1225,1218,1212,1206,1201,1195,1190,1185,1180,1175,1170,1165,1162,1158,1153,1149,1145,1141,1138,1135,1131,1127,1124}	
//};		





//u16 TableAdc[8][72]={
//{3718,3621,3537,3441,3374,3287,3225,3147,3070,2996,2924,2854,2788,2728,2660,2600,2542,2489,2421,2357,2305,2246,2188,2135,2083,2030,1986,1934,1896,1855,1811,1762,1720,931,906,882,865,845,827,805,782,760,737,715,694,675,658,642,625,609,593,577,559
//,545,531,517,504,492,479,464,453,442,431,420,409,398,388,377,367,357,347},
//{3554,3411,3345,3250,3182,3095,3033,2954,2880,2814,2743,2677,2623,2561,2489,2423,2363,2310,2246,2188,2135,2076,2017,1965,1914,1870,1816,1769,1726,1688,1643,1594,1555,931,906,882,865,845,827,805,782,760,737,715,694,675,658,642,625,609,593,577,559,545,
//531,517,504,492,479,464,453,442,431,420,409,398,388,377,367,357,347}, //1,2,3???
//{3428,3302,3213,3122,3034,2948,2871,2792,2717,2626,2556,2492,2410,2350,2282,2205,2148,2094,2017,1951,1898,1836,1783,1730,1675,1618,1584,1530,1482,1445,1403,1358,1313,955,931,906,882,865,845,827,805,782,760,737,715,694,675,658,642,625,609,593,577,559
//,545,531,517,504,492,479,464,453,442,431,420,409,398,388,377,367,357,347},
//{3419,3325,3241,3146,3063,2978,2901,2823,2750,2674,2604,2539,2457,2395,2318,2237,2176,2123,2067,2005,1944,1890,1832,1776,1727,1674,1632,1581,1534,1495,1442,1402,1357,931,906,882,865,845,827,805,782,760,737,715,694,675,658,642,625,609,593,577,559
//,545,531,517,504,492,479,464,453,442,431,420,409,398,388,377,367,357,347},


//{3396,3294,3197,3104,3015,2948,2869,2793,2697,2625,2536,2474,2382,2272,2212,2153,2099,2043,1988,1930,1869,1809,1755,1692,1640,1588,1543,1500,1446,1401,1368,1318,1289,1241,1209,1167,1128,1100,1060,1033,995,960,932,906,880,851,827,805,782,755,730,714,
//693,672,655,635,615,599,578,566,552,533,520,505,496,487,478,469,460,451,442,433},
//{3449,3349,3251,3157,3068,3007,2927,2850,2770,2699,2625,2562,2475,2386,2325,2265,2210,2158,2094,2035,1975,1919,1864,1804,1753,1710,1657,1606,1566,1524,1489,1431,1396,1352,1320,1281,1242,1209,1175,1146,1113,1073,1045,1018,987,958,934,902,879,857,827,
//805,786,766,745,722,701,683,665,648,631,618,596,581,567,553,539,525,511,497,483,469}, 
//	//1,2,3???
//{3378,3278,3181,3088,3000,2926,2845,2768,2685,2613,2532,2469,2377,2295,2234,2174,2120,2065,1990,1925,1867,1811,1765,1710,1661,1617,1564,1518,1480,1433,1400,1342,1311,1264,1227,1197,1146,1118,1082,1055,1025,984,957,931,892,871,848,822,798,775,754,730,
//714,693,674,651,630,614,594,581,566,554,535,521,507,493,479,465,451,437,423,409},

//{3385,3283,3185,3094,3009,2940,2858,2782,2702,2634,2544,2480,2400,2312,2253,2193,2139,2086,2012,1953,1895,1837,1790,1734,1678,1632,1590,1542,1491,1447,1410,1368,1336,1298,1257,1212,1178,1148,1107,1082,1032,1002,976,951,921,891,867,846,821,795,773,754,
//732,712,693,669,649,629,609,602,584,561,555,542,527,512,497,482,467,452,437,422}



//};
//      // 1850,1827,1807,1784,1768,1747,1732,1713,1694,1676,1659,1642,1626,1611,1595,1580,1566,1549,1536,1521,1508,1494,1480,1467,1454,1441,1430,1418,1408,1399,1388,1376,1366

//u16 TableDac[8][72]={
//{1850,1827,1807,1784,1768,1747,1732,1713,1694,1676,1659,1642,1626,1611,1595,1580,1566,1549,1536,1521,1508,1494,1480,1467,1454,1441,1430,1418,1408,1399,1388,1376,1366,1543,1532,1521,1510,
//1502,1494,1486,1476,1466,1456,1446,1436,1427,1419,1411,1404,1397,1390,1383,1376,1368,1361,1355,1349,1343,1337,1331,1325,1320,1315,1310,1305,1300,1295,1290,1286,1282,1278,1274},
//{1835,1801,1786,1763,1747,1726,1711,1692,1674,1659,1642,1626,1613,1598,1581,1565,1551,1536,1523,1509,1496,1482,1468,1455,1443,1432,1419,1408,1398,1389,1378,1366,1357,1543,1532,1521,1510,
//1502,1494,1486,1476,1466,1456,1446,1436,1427,1419,1411,1404,1397,1390,1383,1376,1368,1361,1355,1349,1343,1337,1331,1325,1320,1315,1310,1305,1300,1295,1290,1286,1282,1278,1274},
//{1829,1799,1778,1756,1735,1714,1695,1676,1658,1636,1619,1603,1583,1568,1552,1533,1520,1501,1488,1472,1459,1444,1431,1418,1405,1391,1383,1370,1358,1349,1339,1328,1317,1543,1532,1521,1510,
//1502,1494,1486,1476,1466,1456,1446,1436,1427,1419,1411,1404,1397,1390,1383,1376,1368,1361,1355,1349,1343,1337,1331,1325,1320,1315,1310,1305,1300,1295,1290,1286,1282,1278,1274},
//{1830,1808,1788,1765,1745,1724,1705,1686,1668,1650,1633,1617,1597,1582,1563,1543,1529,1515,1502,1487,1472,1459,1445,1431,1419,1406,1396,1384,1372,1363,1350,1340,1329,1532,1521,1510,1502,
//1494,1486,1476,1466,1456,1446,1436,1427,1419,1411,1404,1397,1390,1383,1376,1368,1361,1355,1349,1343,1337,1331,1325,1320,1315,1310,1305,1300,1295,1290,1286,1282,1278,1274,1274},
//	
//{1861,1836,1812,1789,1767,1750,1730,1711,1687,1669,1647,1631,1608,1580,1565,1551,1537,1524,1510,1495,1480,1465,1451,1435,1422,1409,1398,1387,1373,1362,1353,1341,1333,1321,1312,1302,1292,
//1285,1275,1268,1259,1250,1243,1236,1229,1222,1216,1210,1204,1197,1191,1187,1181,1176,1171,1166,1161,1156,1151,1148,1144,1139,1136,1132,1129,1126,1123,1120,1117,1114,1111,1108},
//{1859,1834,1810,1787,1765,1750,1730,1711,1691,1673,1655,1639,1617,1594,1579,1565,1551,1538,1523,1508,1493,1479,1465,1450,1437,1426,1413,1401,1391,1380,1371,1357,1348,1337,1329,1319,1309,
//1301,1292,1285,1277,1267,1260,1253,1245,1238,1232,1224,1218,1212,1205,1200,1194,1189,1184,1178,1173,1168,1163,1159,1154,1151,1146,1142,1138,1134,1130,1126,1122,1118,1114,1110},
//{1853,1828,1804,1781,1759,1740,1720,1701,1680,1662,1642,1626,1603,1581,1566,1552,1538,1525,1506,1489,1475,1461,1449,1435,1422,1411,1398,1387,1377,1365,1356,1342,1334,1322,1313,1305,1292,
//1285,1276,1269,1262,1252,1245,1238,1228,1223,1217,1210,1204,1198,1193,1187,1182,1177,1172,1166,1161,1156,1151,1148,1144,1141,1136,1132,1128,1124,1120,1116,1112,1108,1104,1100},
//{1827,1802,1778,1756,1735,1718,1698,1679,1660,1643,1621,1605,1585,1562,1548,1534,1521,1508,1490,1475,1461,1447,1435,1421,1407,1396,1386,1374,1361,1350,1341,1331,1323,1313,1303,1292,1283,
//1276,1266,1259,1247,1240,1233,1227,1219,1212,1206,1200,1194,1187,1182,1177,1171,1166,1161,1155,1150,1145,1140,1138,1133,1127,1126,1122,1118,1114,1110,1106,1102,1098,1094,1090}	
//};		  







/* define ---------------------------------------------------------------------*/
//#define ADC_CDR_ADDRESS          ((uint32_t)0x40012308)
#define ADC_CDR_ADDRESS          ((uint32_t)0x4001204C)

/* 变量 ----------------------------------------------------------------------*/
volatile u16 aADCDualConvertedValue[64][8];
 volatile float TempNow[8];
 volatile u8 TempLast[8]={0};

 volatile u16 ConvertedValue[96][8];
 
 //768
 
//volatile u16 FilterValue[8];

u16 BDDac[8];

u16 BDAdc[8];
 
 
u8 FlagDMA=0; 
 
 u8 JRFlag =0;
 u16 JRTime  =0;
/*
*********************************************************************************************************
*	函 数 名: bsp_InitADC
*	功能说明: ADC初始化
*	形    参: 无
*	返 回 值: 无
*********************************************************************************************************
*/
extern unsigned char temp_dma[120];
void bsp_InitADC(void)
{
	ADC_InitTypeDef       ADC_InitStructure;
	ADC_CommonInitTypeDef ADC_CommonInitStructure;
	DMA_InitTypeDef       DMA_InitStructure;
	GPIO_InitTypeDef      GPIO_InitStructure;
	NVIC_InitTypeDef NVIC_InitStructure;
	
	
	/* 使能外设时钟 */
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_DMA2 | RCC_AHB1Periph_GPIOA , ENABLE);
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);
    
    /* 配置引脚 */
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2|GPIO_Pin_3|GPIO_Pin_4|GPIO_Pin_5|GPIO_Pin_6|GPIO_Pin_7;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;                          //@lyt，模拟输入
	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;
	GPIO_Init(GPIOA, &GPIO_InitStructure);
    


	/* DMA2 Stream0 channel0 配置-------------------------------------------------- */
	DMA_InitStructure.DMA_Channel = DMA_Channel_0;                            //通道0
	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)ADC_CDR_ADDRESS;
	DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)&ConvertedValue;
	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
	DMA_InitStructure.DMA_BufferSize = 768;                                      //
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
    
  DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;//每次DMA传输，一个数据的大小
  DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_HalfWord;
    
	DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;
	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Disable;         
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;                 //一次传输，分为多少数据块
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
	DMA_Init(DMA2_Stream0, &DMA_InitStructure);
	
	NVIC_InitStructure.NVIC_IRQChannel = DMA2_Stream0_IRQn;//串口1中断通道
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority=3;//抢占优先级3
	NVIC_InitStructure.NVIC_IRQChannelSubPriority =2;		//子优先级3
	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;			//IRQ通道使能
	NVIC_Init(&NVIC_InitStructure);	//根据指定的参数初始化VIC寄存器、	
	
	
	DMA_ITConfig(DMA2_Stream0, DMA_IT_TC, ENABLE);//开启中断   
	
	
	
	
	
	DMA_InitStructure.DMA_Channel = DMA_Channel_4;                            //通道0
	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)&USART1->DR;
	DMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)temp_dma;
	DMA_InitStructure.DMA_DIR = DMA_DIR_MemoryToPeripheral;
	DMA_InitStructure.DMA_BufferSize = 120;                                      //
	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
    
  DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;//每次DMA传输，一个数据的大小
  DMA_InitStructure.DMA_MemoryDataSize = DMA_PeripheralDataSize_Byte;
    
	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
	DMA_InitStructure.DMA_Priority = DMA_Priority_Medium;
	DMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Disable;         
	DMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;
	DMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_Single;                 //一次传输，分为多少数据块
	DMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;
	DMA_Init(DMA2_Stream7, &DMA_InitStructure);

//	/* DMA2_Stream0 enable */
//	DMA_Cmd(DMA2_Stream0, ENABLE);
//    
    /****************************************************************************   
	  PCLK2 = HCLK / 2 
	  下面选择的是2分频
	  ADCCLK = PCLK2 /8 = HCLK / 8 = 168 / 8 = 21M
      ADC采样频率： Sampling Time + Conversion Time = 480 + 12 cycles = 492cyc
                    Conversion Time = 21MHz / 492cyc = 42.6ksps. 
	*****************************************************************************/
    
	/* ADC Common 配置 ----------------------------------------------------------*/
    ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;
    ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div4;
    ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled;
    ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_10Cycles;
    ADC_CommonInit(&ADC_CommonInitStructure);

	/* ADC1 regular channel 12 configuration ************************************/
	ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;
	ADC_InitStructure.ADC_ScanConvMode = ENABLE;
	ADC_InitStructure.ADC_ContinuousConvMode = DISABLE;
	ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConvEdge_Rising;
	ADC_InitStructure.ADC_ExternalTrigConv =ADC_ExternalTrigConv_T2_TRGO;
	ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;
	ADC_InitStructure.ADC_NbrOfConversion = 8;
    ADC_Init(ADC1, &ADC_InitStructure);
    
     /* Enable ADC1 DMA */
    ADC_DMACmd(ADC1, ENABLE);    //@lyt， 开启adc的dma支持，需要使用dma还需配置dma

//    /* ADC1 regular channel18 (VBAT) configuration ******************************/
//    ADC_RegularChannelConfig(ADC1, ADC_Channel_16, 1, ADC_SampleTime_480Cycles);
//    /* ADC1 regular channel18 (VBAT) configuration ******************************/
//    ADC_RegularChannelConfig(ADC1, ADC_Channel_Vbat, 2, ADC_SampleTime_144Cycles);
    
    /* ADC1 regular channels 10, 11 configuration */ 
    ADC_RegularChannelConfig(ADC1, ADC_Channel_0, 1, ADC_SampleTime_15Cycles);
    ADC_RegularChannelConfig(ADC1, ADC_Channel_1, 2, ADC_SampleTime_15Cycles);   
		
	  ADC_RegularChannelConfig(ADC1, ADC_Channel_2, 3, ADC_SampleTime_15Cycles);
    ADC_RegularChannelConfig(ADC1, ADC_Channel_3, 4, ADC_SampleTime_15Cycles); 
		
		ADC_RegularChannelConfig(ADC1, ADC_Channel_4, 5, ADC_SampleTime_15Cycles);
    ADC_RegularChannelConfig(ADC1, ADC_Channel_5, 6, ADC_SampleTime_15Cycles);   
		
	  ADC_RegularChannelConfig(ADC1, ADC_Channel_6, 7, ADC_SampleTime_15Cycles);
    ADC_RegularChannelConfig(ADC1, ADC_Channel_7, 8, ADC_SampleTime_15Cycles); 



    /* Enable DMA request after last transfer (Single-ADC mode) */
    ADC_DMARequestAfterLastTransferCmd(ADC1, ENABLE);            //源数据变化时，开启DMA

    DMA_Cmd(DMA2_Stream0, ENABLE);
    /* Enable ADC1 **************************************************************/
    ADC_Cmd(ADC1, ENABLE);
    
        /* Start ADC1 Software Conversion */
    ADC_SoftwareStartConv(ADC1);
}


//#define Num 64 
//u32 value_data[8] ={0};
////extern u32 FilterValue[8];

//void filter(void)
//{
////  u16  count,i,k,j,temp; 	
////	
////	for(k=0;k<8;k++)
////	{
////		for(count=0;count<Num;count++)
////		{
////			  value_data[k]+=aADCDualConvertedValue[count][k];
////		}

////		FilterValue[k]= (value_data[k]>>6)*0.61035; //0.61035
////		value_data[k]=0;		
////	}
//}

void DMA2_Stream0_IRQHandler(void)
{
	
	if(DMA_GetITStatus(DMA2_Stream0,DMA_IT_TCIF0)!=RESET)
	{
		 TIM_Cmd(TIM2, DISABLE);		
		// filter();		
		 FlagDMA =1;
	}	
	DMA_ClearITPendingBit(DMA2_Stream0,DMA_IT_TCIF0);
	//TIM_Cmd(TIM2, ENABLE);
}


//初始化ADC															   
void  Adc_Init(void)
{    
  GPIO_InitTypeDef  GPIO_InitStructure;
	ADC_CommonInitTypeDef ADC_CommonInitStructure;
	ADC_InitTypeDef       ADC_InitStructure;
	
  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);//使能GPIOA时钟
  RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE); //使能ADC1时钟

  //先初始化ADC1通道5 IO口
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0|GPIO_Pin_1|GPIO_Pin_2|GPIO_Pin_3;//PA5 通道5
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;//模拟输入
  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL ;//不带上下拉
  GPIO_Init(GPIOA, &GPIO_InitStructure);//初始化  
 
	RCC_APB2PeriphResetCmd(RCC_APB2Periph_ADC1,ENABLE);	  //ADC1复位
	RCC_APB2PeriphResetCmd(RCC_APB2Periph_ADC1,DISABLE);	//复位结束	 
 
	
  ADC_CommonInitStructure.ADC_Mode = ADC_Mode_Independent;//独立模式
  ADC_CommonInitStructure.ADC_TwoSamplingDelay = ADC_TwoSamplingDelay_10Cycles;//两个采样阶段之间的延迟5个时钟
  ADC_CommonInitStructure.ADC_DMAAccessMode = ADC_DMAAccessMode_Disabled; //DMA失能
  ADC_CommonInitStructure.ADC_Prescaler = ADC_Prescaler_Div4;//预分频4分频。ADCCLK=PCLK2/4=84/4=21Mhz,ADC时钟最好不要超过36Mhz 
  ADC_CommonInit(&ADC_CommonInitStructure);//初始化
	
  ADC_InitStructure.ADC_Resolution = ADC_Resolution_12b;//12位模式
  ADC_InitStructure.ADC_ScanConvMode = ENABLE;//非扫描模式	
  ADC_InitStructure.ADC_ContinuousConvMode = DISABLE;//关闭连续转换
  ADC_InitStructure.ADC_ExternalTrigConvEdge = ADC_ExternalTrigConv_T2_TRGO;//禁止触发检测，使用软件触发
  ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;//右对齐	
  ADC_InitStructure.ADC_NbrOfConversion = 8;//1个转换在规则序列中 也就是只转换规则序列1 
  ADC_Init(ADC1, &ADC_InitStructure);//ADC初始化
	
 
	ADC_Cmd(ADC1, ENABLE);//开启AD转换器	

}				  
//获得ADC值
//ch: @ref ADC_channels 
//通道值 0~16取值范围为：ADC_Channel_0~ADC_Channel_16
//返回值:转换结果
u16 Get_Adc(u8 ch)   
{
	  	//设置指定ADC的规则组通道，一个序列，采样时间
	ADC_RegularChannelConfig(ADC1, ch, 1, ADC_SampleTime_112Cycles );	//ADC1,ADC通道,480个周期,提高采样时间可以提高精确度			    
  
	ADC_SoftwareStartConv(ADC1);		//使能指定的ADC1的软件转换启动功能	
	 
	while(!ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC ));//等待转换结束

	return ADC_GetConversionValue(ADC1);	//返回最近一次ADC1规则组的转换结果
}
//获取通道ch的转换值，取times次,然后平均 
//ch:通道编号
//times:获取次数
//返回值:通道ch的times次转换结果平均值
u16 Get_Adc_Average(u8 ch,u8 times)
{
	u32 temp_val=0;
	u8 t;
	for(t=0;t<times;t++)
	{
		temp_val+=Get_Adc(ch);
		delay_ms(5);
	}
	return temp_val/times;
} 




//定时器采集
//

//平滑滤波算法；

//



//extern u16 vol_to_temp[8][90];	 
float TableSearchTemperature(u8 jj,u16 adcv) 
{	
//	u16  k,j;	
//	u16  left = 0, right = 89, mid = 45;	
//	
//	if(adcv<vol_to_temp[jj][89])
//	{
//		return 120;			
//	}
//	else if(adcv > vol_to_temp[jj][0])
//	{		
//		return 30; //nomal temp		
//	}
//	else 
//	{		
//			for( j=0;j<7;j++ )
//			{				
//				mid = ( left + right ) / 2;
//				if( vol_to_temp[jj][mid] == adcv )
//				{
//					return (mid+31);		
//				}		
//				
//			  if( (adcv>vol_to_temp[jj][mid])&&(adcv<vol_to_temp[jj][mid-1]) )
//			  {				
//				  return (( float)(adcv- vol_to_temp[jj][mid])/(vol_to_temp[jj][mid-1]-vol_to_temp[jj][mid])  + mid+ 31);	
//		  	}	
//				
//				if( (adcv>vol_to_temp[jj][mid+1])&&(adcv<vol_to_temp[jj][mid]) )
//			  {				
//				  return (( float)(adcv- vol_to_temp[jj][mid+1])/(vol_to_temp[jj][mid]-vol_to_temp[jj][mid+1])  + mid+ 32);	
//		  	}	
//				
//				if( vol_to_temp[jj][mid] < adcv )
//					right = mid - 1;
//				else 	if( vol_to_temp[jj][mid] > adcv )
//					left = mid + 1;
//			}
//		
//	}
//	

}

#define Num 32 
//	u32 value_data[8] ={0};
void filter(void)
{
	u8 count,h,i,j,temp;
	u16 k;
	u32 value_d;
	u16 value_bu[32];
	u16 low,high,tmp;
	
	value_d =0;
		for(k=0;k<8;k++)
		{
	    low = 0;   
      high= 31; //????????  

       while (low < high) {  
        for (j= low; j< high; ++j) //????,?????  
            if (ConvertedValue[j][k]> ConvertedValue[j+1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j+1][k];ConvertedValue[j+1][k]=tmp;  
            }   
        --high;                 //??high?, ????  
        for ( j=high; j>low; --j) //????,?????  
            if (ConvertedValue[j][k]<ConvertedValue[j-1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j-1][k];ConvertedValue[j-1][k]=tmp;  
            }  
        ++low;                  //??low?,????  
      }  

	  	for(count=8;count<24;count++)
	  	{
			  value_d +=ConvertedValue[count][k];
	  	}
     
      BDAdc[k]= value_d>>4;
	  	value_d= 0;
	}

}


u16  filters(u8 k)
{
	u8 count,h,i,j;

	u32 value_d;
	u16 value_bu[96];
	u16 low,high,tmp;
	    
	    value_d =0;
	    low = 0;   
      high= 95; //????????  

       while (low < high) {  
        for (j= low; j< high; ++j) //????,?????  
            if (ConvertedValue[j][k]> ConvertedValue[j+1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j+1][k];ConvertedValue[j+1][k]=tmp;  
            }   
        --high;                 //??high?, ????  
        for ( j=high; j>low; --j) //????,?????  
            if (ConvertedValue[j][k]<ConvertedValue[j-1][k]) {  
                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j-1][k];ConvertedValue[j-1][k]=tmp;  
            }  
        ++low;                  //??low?,????  
      }  

	  	for(count=32;count<64;count++)  //8-32  12  20
	  	{
			  value_d +=ConvertedValue[count][k];
	  	}
     
      return (value_d>>5);

	
}




//u16  filters(u8 k)
//{
//	u8 count,h,i,j;

//	u32 value_d;
//	u16 value_bu[32];
//	u16 low,high,tmp;
//	    
//	    value_d =0;
//	    low = 0;   
//      high= 31; //????????  

//       while (low < high) {  
//        for (j= low; j< high; ++j) //????,?????  
//            if (ConvertedValue[j][k]> ConvertedValue[j+1][k]) {  
//                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j+1][k];ConvertedValue[j+1][k]=tmp;  
//            }   
//        --high;                 //??high?, ????  
//        for ( j=high; j>low; --j) //????,?????  
//            if (ConvertedValue[j][k]<ConvertedValue[j-1][k]) {  
//                tmp = ConvertedValue[j][k]; ConvertedValue[j][k]=ConvertedValue[j-1][k];ConvertedValue[j-1][k]=tmp;  
//            }  
//        ++low;                  //??low?,????  
//      }  

//	  	for(count=8;count<24;count++)  //8-32  12  20
//	  	{
//			  value_d +=ConvertedValue[count][k];
//	  	}
//     
//      return (value_d>>4);
//	  	
//	
//	
//	
//}




u16 GetVoltageDACS(u16 temperature,u8 index)
{
  u16 DacV=0;
	u8 i;
  //加热区间 40-99度；//31-102
	i=temperature-29;
	if(i<0)
	{
		
		
		DacV=2500;
		
		//err; 设置温度保护；
		
		return DacV;
		
		
	}
  else if(i>71)
	{
		i=71;
		//err ;over temp
		//DacV=2500; 
		
		//DacV=2500; 
		
    return TableDac[index][71];		
	}
	
	
	else return TableDac[index][i];		
	
	
}


float  TableSearchTemperatures(u16 adcv,u8 idex)

{
	//u16 adcv;
  u16 j;
	float xs;
//	u16  min = 1000;
//	u16  IndexSearch = 0;
	
	u16  left = 0, right = 71, mid = 36;
	
 //adcv=Get_Adc_Average(1,10);
	
	if(adcv<TableAdc[idex][71])
	{
		//过温报警了吧；
		return 105;	
		
	}
	else if(adcv>TableAdc[idex][0])
	{
		
		return 28; //nomal temp
		
	}
	else 
	{
		
			for( j=0;j<7;j++ ) ///////////////////////////////////????????????????????????????????????
			{
				
				
				mid = ( left + right ) / 2;
				if( TableAdc[idex][mid] == adcv )
				{
					
					return (mid+29);		
				}		
				
			  if((adcv>TableAdc[idex][mid])&&(adcv<TableAdc[idex][mid-1]) )
			  {
           xs=( float) (adcv- TableAdc[idex][mid])/(TableAdc[idex][mid-1]-TableAdc[idex][mid]);
				//printf("temper=%d",mid+40);
				  return (mid+29-xs);		
		  	}	
				
				if( TableAdc[idex][mid] < adcv )
					right = mid - 1;
				else if( TableAdc[idex][mid] > adcv )
					left = mid + 1;
			}
		
	}

}